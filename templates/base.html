{% load static %}
{% load socialaccount %}
{% load tags %}

<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />  
    <title>{% block title %}{% endblock title %}TBIA</title>
    <link rel="stylesheet" type="text/css" href="{% static 'tw/theme.css' %}" />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="{% static 'js/gsap.min.js' %}"></script>
    <script src="{% static 'js/ScrollTrigger.min.js' %}"></script>
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'image/favicon-32x32.png' %}" />
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'image/favicon-16x16.png' %}" />
    <link rel="shortcut icon" href="{% static 'image/favicon.ico' %}" />
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    {% block head %}{% endblock head %}
    {% block style %}{% endblock style %}
    <style>

    .popbg .wbox_center .map_img .img {
        background: none;
    }
    
    .search_condition_are .secboxtop2 .rightbox .map_img .img {
      background: none;
    }

    .sc_de_main .right_area .map_img .img {
      background: none;
    }

    .header .right_btn2 .member_login .member_slimenu ul li {
      border-bottom-left-radius: 15px;
    }

     .checka {
        cursor: pointer
    }

    .checka:hover {
        color: #e36262 !important
    }
    
    .footer .copy a {
        color: #FFF;
        text-align: center;
        font-size: 14px;
        font-weight: normal;
        cursor: pointer;
        margin: 0 5px
    }
    

    .message_list li, .ringbox .titlebox p {
      cursor: default
    }


    .header .right_btn2 .ringbox .messagebox .wbox .message_list li .txtcont p {
        height: 20px;
    }
    

    .header .right_btn2 .ringbox .messagebox .wbox .titlebox button:hover {
        color: #E2A460;
    }
    
      /*
      .popbg .loginbox .right_cont .checkbox_area {
        margin-bottom: 20px;
    }*/
    
  .popbg .wbox_center {

      max-height: 650px;
  }
    

  ::placeholder {
      color: #707070;
    }  

    .input_item select {
      -webkit-appearance: menulist-button;
      color: black !important;
    }
    
    .input_item select:invalid {
      color: #707070 !important;
    }
    
  
    input {
      color: black !important;
    }

    .section_1 .content_area .input_set button svg {
      height: 39px
  }

  .section_1 .content_area .input_set button {
    margin-top: -20px
  }

        
    .header .right_btn2 .member_login:hover p {
      color: #76A578;
    }

    .footer .right_inf .addpart {
      width: 190px;
    }

    @media only screen and (max-width: 767px) {
      .footer .right_inf .addpart {
          width: 100%;
      }
    }
    
    .loginbox .right_cont {
      z-index: 2;
    }

    .popbg .xx {
      z-index: 3;
    }
    </style>
  </head>

  <body>
  <!--loading-->
  <div class="loading_area" style="display: none">
    <div class="sc">
      <div class="load"><span>L</span>ading</div>
    </div>
  </div>


  <!--通用訊息匡pop-->
<div class="messageboxfix" style="display: none;">
	<div class="message_box">
		<div class="informationicon">!</div>
		<p>確認送出？</p>
		<div class="btn_area">
			<button>取消</button>
			<button>確認</button>
		</div>
	</div>
</div>

<!--意見回饋popbox-->
<div class="popbg feedback-pop" style="display:none;">
	<div class="ovhy">
		<div class="wbox_center">
			<div class="xx">

			</div>
			<div class="titlegreen">
				意見回饋
			</div>
			<p class="shortxt">
        請填寫下列表格，我們會將會盡快回覆
			</p>
			<div class="from_area">
				<div class="select_twobox"> 
					<select name="" id="" required>
						<option value="">請選擇回饋對象</option>
					</select>
					<select name="" id="" required>
						<option value="">請選擇問題類型</option>
					</select>				
				</div>
				<div class="txt_area">
					<p>問題描述：</p>
					<textarea></textarea>
				</div>
				<div class="email_area">
					<p>您的電⼦郵件
					<input type="text" value="{{ request.user.email|default_if_none:'' }}">
				</div>
				<button class="send">確認送出</button>
			</div>
		</div>
	</div>
</div>


    <div class="header clearfix">
      <div class="main_1240">
        <a href="{% url 'index' %}" class="logo_area">
          <img src="{% static 'image/logo_top.svg' %}" />
        </a>

        <div class="right_mbhambuger">
          <div class="hmenu hmenu-2">
            <span></span>
          </div>
        </div>
      
        <!--手機選單-->
        <div class="mb_bmenu">
          <div class="ovh">
            <ul>
              {% if user.is_authenticated %}
              <li class="rd_mb_two_menu_li">
                <a href="#" class="one_set">
                  <p class="gres">Hello, {{ user.name }}</p>
                  <img class="ardown" src="{% static 'image/ardown.svg' %}" >
                </a>
                <div class="mbmu2">
                  <a href="#" class="s_title">
                    <p>帳號後台</p>
                    <img class="arright" src="{% static 'image/next.svg' %}" >
                  </a>
                  {% if user.is_partner_admin or user.is_partner_account %}
                  <a href="{% url 'manager_partner' %}" class="s_title">
                    <p>單位後台</p>
                    <img class="arright" src="{% static 'image/next.svg' %}" >
                  </a>
                  {% endif %}
                  {% if user.is_system_admin %}
                  <a href="{% url 'manager_system' %}" class="s_title">
                    <p>系統管理後台</p>
                    <img class="arright" src="{% static 'image/next.svg' %}" >
                  </a>
                  {% endif %}
                  <a href="{% url 'logout' %}" class="s_title">
                    <p>登出</p>
                    <img class="arright" src="{% static 'image/next.svg' %}" >
                  </a>						
                </div>
              </li>   
              {% else %}
              <li>
                <a href="javascript:;" onclick="$('.login_pop').show();$('.login_pop .loginbox').css('display', 'none'); $('.login_pop .login_area').css('display', '')" class="one_set">
                  <p>會員登入</p>
                  <img class="arright" src="{% static 'image/next.svg' %}" />
                </a>
              </li>
              {% endif %}
              <li>
                <a href="{% url 'about' %}" class="one_set">
                  <p>關於TBIA</p>
                  <img class="arright" src="{% static 'image/next.svg' %}" />
                </a>
              </li>
              <li class="rd_mb_two_menu_li">
                <a href="" class="one_set rd_mb_two_menu">
                  <p>條件搜尋</p>
                  <img class="ardown" src="{% static 'image/ardown.svg' %}" />
                </a>
                <div class="mbmu2">
                  <a href="{% url 'search_occurrence' %}" class="s_title">
                    <p>物種出現紀錄查詢</p>
                    <img class="arright" src="{% static 'image/next.svg' %}" />
                  </a>
                  <a href="{% url 'search_collection' %}" class="s_title">
                    <p>自然史典藏查詢</p>
                    <img class="arright" src="{% static 'image/next.svg' %}" />
                  </a>
                </div>
              </li>
              <li class="rd_mb_two_menu_li">
                <a href="#" class="one_set rd_mb_two_menu">
                  <p>最新消息</p>
                  <img class="ardown" src="{% static 'image/ardown.svg' %}" />
                </a>
                <div class="mbmu2">
                  <a href="#" class="s_title">
                    <p>新聞公告</p>
                    <img class="arright" src="{% static 'image/next.svg' %}" />
                  </a>
                  <a href="#" class="s_title">
                    <p>活動訊息</p>
                    <img class="arright" src="{% static 'image/next.svg' %}" />
                  </a>
                  <a href="#" class="s_title">
                    <p>計畫徵求</p>
                    <img class="arright" src="{% static 'image/next.svg' %}" />
                  </a>
                </div>
              </li>
              <li class="rd_mb_two_menu_li">
                <a href="{% url 'resources' %}" class="one_set rd_mb_two_menu">
                  <p>開放資料相關資源</p>
                  <img class="ardown" src="{% static 'image/ardown.svg' %}" />
                </a>
                <div class="mbmu2">
                  <a href="{% url 'resources' %}?type=strategy" class="s_title">
                    <p>TBIA 策略文件</p>
                    <img class="arright" src="{% static 'image/next.svg' %}" />
                  </a>
                  <a href="{% url 'resources' %}?type=guide" class="s_title">
                    <p>開放資料指引</p>
                    <img class="arright" src="{% static 'image/next.svg' %}" />
                  </a>
                  <a href="{% url 'resources' %}?type=tool" class="s_title">
                    <p>參考文件/工具</p>
                    <img class="arright" src="{% static 'image/next.svg' %}" />
                  </a>
                  <a href="{% url 'resources' %}?type=tutorial" class="s_title">
                    <p>教學文件</p>
                    <img class="arright" src="{% static 'image/next.svg' %}" />
                  </a>
                </div>
              </li>
              <li>
                <a href="{% url 'qa' %}" class="one_set">
                  <p>常見Q&A</p>
                  <img class="arright" src="{% static 'image/next.svg' %}" />
                </a>
              </li>
            </ul>
          </div>
        </div>
        <!--主選單-->
        <div class="right_menu">
          <ul>
            <li>
              <a href="{% url 'about' %}" class="big_title">關於TBIA</a>
              <div class="line"></div>
            </li>
            <li>
              <a href="javascript:;" class="big_title">條件搜尋</a>
              <div class="line"></div>
              <div class="menu_2">
                <div class="item">
                  <a href="{% url 'search_occurrence' %}" class="s_title">物種出現紀錄查詢</a>
                  <a href="{% url 'search_collection' %}" class="s_title">自然史典藏<br>查詢</a>
                </div>
              </div>
            </li>
            <li>
              <a href="{% url 'news' %}" class="big_title">最新消息</a>
              <div class="line"></div>
              <div class="menu_2">
                <div class="item">
                  <a href="{% url 'news' %}?type=news" class="s_title">新聞公告</a>
                  <a href="{% url 'news' %}?type=event" class="s_title">活動訊息</a>
                  <a href="{% url 'news' %}?type=project" class="s_title">計畫徵求</a>
                </div>
              </div>
            </li>
            <li>
              <a href="{% url 'resources' %}" class="big_title">開放資料相關資源</a>
              <div class="line"></div>
              <div class="menu_2">
                <div class="item">
                  <a href="{% url 'resources' %}?type=strategy" class="s_title">TBIA 策略文件</a>
                  <a href="{% url 'resources' %}?type=guide" class="s_title">開放資料指引</a>
                  <a href="{% url 'resources' %}?type=tool" class="s_title">參考文件/工具</a>
                  <a href="{% url 'resources' %}?type=tutorial" class="s_title">教學文件</a>
                </div>
              </div>
            </li>
            <li>
              <a href="{% url 'qa' %}" class="big_title">常見Q&A</a>
              <div class="line"></div>
            </li>
          </ul>
        </div>
        {% if user.is_authenticated %}
        <div class="right_btn2 login_done">
        {% else %}
        <div class="right_btn2">
        {% endif %}
          <div class="feedback" onclick="$('.feedback-pop').show()"></div>
          <div class="ringbox ">
            {% if user.id|get_notif_count > 0 %}
            <div class="num_message">{{ user.id|get_notif_count }}</div>
            {% endif %}
            <div class="messagebox">
              <div class="wbox">
                <div class="titlebox">
                  <p>最近10筆通知</p>
                  <div>
                  <button onclick="updateIsRead()">全部已讀</button>
                  <a href="{% url 'manager' %}?menu=notification">查看全部</a>
                  </div>
                </div>
                <ul class="message_list">
                  {{ user.id|get_notif }}
                </ul>
              </div>
            </div>
          </div>
          <div class="member_login">

          {% comment %} <div onclick="$('.login_pop').show(); $('.login_pop .loginbox').css('display', 'none'); $('.login_pop .login_area').css('display', '')" class="member_login"> {% endcomment %}
            <div class="icon"></div>
              <p onclick="$('.login_pop').show(); $('.login_pop .loginbox').css('display', 'none'); $('.login_pop .login_area').css('display', '')"  style="">登入</p>
              <div class="member_slimenu">
                <ul>
                  <li onclick="window.location=`{% url 'manager' %}`">帳號後台</li>
                  {% if user.is_partner_admin or user.is_partner_account %}
                  <li onclick="window.location=`{% url 'manager_partner' %}`">單位後台</li>
                  {% endif %}
                  {% if user.is_system_admin %}
                  <li onclick="window.location=`{% url 'manager_system' %}`">系統管理後台</li>
                  {% endif %}
                  <li onclick="window.location='/logout'">登出</li>
                </ul>
              </div>        
          </div>
        </div>
      </div>
    </div>
    {% block body %}{% endblock body %}
    <div class="footer">
      <div class="main_1240">
        <div class="ftlogo_inf">
          <div class="logobox">
            <a href="{% url 'index' %}">
              <img src="{% static 'image/logo_w.svg' %}" alt="臺灣生物多樣性資訊聯盟" />
            </a>
          </div>
          <div class="inf">Email：<a href="mailto:tbianoti@gmail.com">tbianoti@gmail.com</a></div>
        </div>
        <ul class="footer_menu">
          <li>
            <a class="big_link">條件搜尋</a>
            <a href="{% url 'search_occurrence' %}" class="sma_link">物種出現紀錄查詢</a>
            <a href="{% url 'search_collection' %}" class="sma_link">自然史典藏查詢</a>
          </li>
          <li>
            <a href="{% url 'news' %}" class="big_link">最新消息</a>
            <a href="{% url 'news' %}?type=news" class="sma_link">新聞公告</a>
            <a href="{% url 'news' %}?type=event" class="sma_link">活動訊息</a>
            <a href="{% url 'news' %}?type=project" class="sma_link">計畫徵求</a>
          </li>
          <li>
            <a href="{% url 'resources' %}" class="big_link">開放資料相關資源</a>
            <a href="{% url 'resources' %}?type=strategy" class="sma_link">TBIA 策略文件</a>
            <a href="{% url 'resources' %}?type=guide" class="sma_link">開放資料指引</a>
            <a href="{% url 'resources' %}?type=tool" class="sma_link">參考文件/工具</a>
            <a href="{% url 'resources' %}?type=tutorial" class="sma_link">教學文件</a>
          </li>
          <li>
            <a href="{% url 'about' %}" class="big_link">關於TBIA</a>
            <a href="{% url 'qa' %}" class="big_link">常見Q&A</a>
          </li>
        </ul>
        <div class="right_inf">
          <div class="addpart">
            <p>贊助單位</p>
            <div style="display: flex; justify-content: space-between;">
              <a href="https://www.forest.gov.tw" class="cir" target="_blank">
                <img src="{% static 'image/partner/parlogo_4.svg' %}" alt="贊助單位" />
              </a>
              <a href="https://www.forest.gov.tw" class="cir" target="_blank">
                <img src="{% static 'image/partner/國土生態綠網.png' %}" alt="贊助單位" />
              </a>
            </div>
          </div>
        </div>
      </div>
      <div class="copy" style="display: flex;     align-items: center;
      justify-content: center;">
        <a target="_blank" href="{% url 'terms' %}">使用條款</a> | <a target="_blank" href="{% url 'policy' %}">隱私權政策</a>
      </div>
      <div class="copy">
        <h6>Copyright © TBIA 臺灣生物多樣性資訊聯盟</h6>
      </div>
    </div>

    <!--會員登入/註冊/忘記密碼-->
<div class="popbg login_pop" style="display: none;">
	<div class="bgt">
		<img src="{% static 'image/bgt.svg' %}" >
	</div>
	<div class="bgb">
		<img src="{% static 'image/bgb.svg' %}" >
	</div>
	<div class="bgi">
		<img src="{% static 'image/bgi.svg' %}" >
	</div>
	<div class="bga"> 
		<img src="{% static 'image/bga.svg' %}" >
	</div>
	<div class="ovhy"> 
		<div class="wbox_center login">
			<div class="xx">
			</div>
			<div class="left_bg"> 
				<img src="{% static 'image/loginbga.svg' %}" > 
			</div>
			<!--會員登入-->




			<div class="loginbox login_area" >				
				<div class="right_cont">
					<div class="alcont_center">
						<div class="titlegreen">
							會員登入
							<span>Login</span>
						</div>
            <form id="loginForm">
              {% csrf_token %}
              <div class="input_item">
                <input type="text" name="email" placeholder="請輸入您的帳號(email)">
                <!--送出時錯誤出現-->
                <div class="noticbox" style="display: none">
                  <div class="in1">錯誤</div>
                  <p>請輸入正確信箱</p>
                </div>
              </div>
              <div class="input_item">
                <input type="password" name="password" placeholder="請輸入您的密碼">
                <!--送出時錯誤出現-->
                <div class="noticbox" style="display:none;">
                  <div class="in1">錯誤</div>
                  <p>請輸入6~10位英文或數字</p>
                </div>
              </div>

              <div  class="input_item">
                <div
                  class="g-recaptcha "
                  data-sitekey="6Ld1yBIiAAAAABc7fK4tpQvBb6QL4S32CHeFZbNZ"
                  data-theme="light" data-size="normal"
                  data-callback="verify"
                  data-expired-callback="expired"
                  data-error-callback="error">
                  </div>
                  <div class="noticbox" style="display:none;">
                    <div class="in1">錯誤</div>
                    <p>登入前請完成驗證</p>
                  </div>
                </div>
              <div class="checkbox_area">
                <div class="flex_center">
                  <input type="checkbox" name="rememberme">
                  <p>記住我的帳號</p>
                </div>
                <button type="button" class="loginbtn" onclick="login()">登入</button>
              </div>
              </form>
  
              <a class="google_login" href="javascript:;">
                <svg viewBox="0 0 24 24" width="24" height="24" xmlns="http://www.w3.org/2000/svg">
                  <g transform="matrix(1, 0, 0, 1, 27.009001, -39.238998)">
                    <path fill="#4285F4" d="M -3.264 51.509 C -3.264 50.719 -3.334 49.969 -3.454 49.239 L -14.754 49.239 L -14.754 53.749 L -8.284 53.749 C -8.574 55.229 -9.424 56.479 -10.684 57.329 L -10.684 60.329 L -6.824 60.329 C -4.564 58.239 -3.264 55.159 -3.264 51.509 Z"/>
                    <path fill="#34A853" d="M -14.754 63.239 C -11.514 63.239 -8.804 62.159 -6.824 60.329 L -10.684 57.329 C -11.764 58.049 -13.134 58.489 -14.754 58.489 C -17.884 58.489 -20.534 56.379 -21.484 53.529 L -25.464 53.529 L -25.464 56.619 C -23.494 60.539 -19.444 63.239 -14.754 63.239 Z"/>
                    <path fill="#FBBC05" d="M -21.484 53.529 C -21.734 52.809 -21.864 52.039 -21.864 51.239 C -21.864 50.439 -21.724 49.669 -21.484 48.949 L -21.484 45.859 L -25.464 45.859 C -26.284 47.479 -26.754 49.299 -26.754 51.239 C -26.754 53.179 -26.284 54.999 -25.464 56.619 L -21.484 53.529 Z"/>
                    <path fill="#EA4335" d="M -14.754 43.989 C -12.984 43.989 -11.404 44.599 -10.154 45.789 L -6.734 42.369 C -8.804 40.429 -11.514 39.239 -14.754 39.239 C -19.444 39.239 -23.494 41.939 -25.464 45.859 L -21.484 48.949 C -20.534 46.099 -17.884 43.989 -14.754 43.989 Z"/>
                  </g>
                  <p>使用Google登入</p>
                </svg>
              </a>
						<div class="linkbtn_2">
							<a href="javascript:;" onclick="$('.login_pop .loginbox').css('display', 'none'); $('.login_pop .register_area').css('display', '')">我要註冊</a>
							<a href="javascript:;" onclick="$('.login_pop .loginbox').css('display', 'none'); $('.login_pop .password_area').css('display', '')">忘記密碼?</a>
						</div>
					</div>
				</div>
			</div>






      
			<!--會員註冊-->
			<div class="loginbox register_area" style="display: none;">				
				<div class="right_cont">
					<div class="alcont_center">
						<div class="titlegreen">
							會員註冊
							<span>Register</span>
						</div>
            <form id="registerForm">
            {% csrf_token %}
              <div class="input_item">
                <input type="text" name="name" placeholder="姓名">
                <!--送出時錯誤出現-->
                <div class="noticbox" style="display: none;">
                  <div class="in1">錯誤</div>
                  <p>請輸入姓名</p>
                </div>
              </div>
              <div class="input_item">
                <input type="text" name="email" placeholder="請輸入您的Email作為帳號">
                <!--送出時錯誤出現-->
                <div class="noticbox" style="display: none;">
                  <div class="in1">錯誤</div>
                  <p>請輸入正確信箱</p>
                </div>
              </div>
              <div class="input_item">
                <input type="password" name="password" placeholder="請輸入您的密碼">
                <!--送出時錯誤出現-->
                <div class="noticbox" style="display: none;">
                  <div class="in1">錯誤</div>
                  <p>請輸入6~10位英文或數字</p>
                </div>
              </div>
              <div class="input_item">
                <input type="password" name="repassword" placeholder="請再次輸入密碼">
                <!--送出時錯誤出現-->
                <div class="noticbox" style="display: none;">
                  <div class="in1">錯誤</div>
                  <p>兩次密碼輸入不同</p>
                </div>
              </div>
            </form>
						<button class="loginbtn" onclick="register()">註冊</button>
						<div class="linkbtn_1">
							*註冊即代表您同意我們的<a class="checka" target="_blank" href="{% url 'terms' %}">使⽤條款</a>
						</div>
					</div>
				</div>
			</div> 
			<!--忘記密碼-->
			<div class="loginbox password_area" style="display: none;">				
				<div class="right_cont">
					<div class="alcont_center">
						<div class="titlegreen">
							忘記密碼
							<span>Password</span>
						</div>
						<p class="center">請輸入當初加入會員使用的E-Mail，我們將協助您重新設定密碼。</p>
						<div class="input_item">
							<input type="text" name="reset_email" placeholder="請輸入您的email">
						</div>
						<button class="loginbtn resetbtn">確認送出</button>
						<div class="linkbtn_2">
							<a href="javascript:;" onclick="$('.login_pop .loginbox').css('display', 'none'); $('.login_pop .register_area').css('display', '')">我要註冊</a>
							<a href="javascript:;" onclick="$('.login_pop .loginbox').css('display', 'none'); $('.login_pop .login_area').css('display', '')">返回登入?</a>
						</div>
					</div>
				</div>
			</div>			
		</div>
	</div>
</div>

  </body>
  <script>


    function updateIsRead(){
      $.ajax({
        url: "{% url 'update_is_read' %}",
        type: 'GET',
        success: function(){
          $('.message_list li .dottt, .num_message').hide()
        }
       });
    }
    function updateThisRead(n_id){
      $.ajax({
        url: `{% url 'update_this_read' %}?n_id=${n_id}`,
        type: 'GET',
        success: function(response){
          $(`.message_list li[data-nid=${n_id}] .dottt`).hide()
          if (response.count > 0){
              $('.num_message').html(response.count)
          } else {
              $('.num_message').hide()
          }
        }
       });
    }


    $(function () {

      $('.google_login').on('click', function(){
        let next_url = window.location.pathname;
        
        if ('URLSearchParams' in window) {
          var searchParams = new URLSearchParams(window.location.search)          
          next_url = window.location.pathname + '?' + searchParams.toString();
        } 
       window.location.href = "{% provider_login_url 'google' %}?next=" + encodeURIComponent(next_url);
        
      })


      $('.resetbtn').on('click',function(){
        $.ajax({
          url: "{% url 'send_reset_password' %}",
          data: {'email': $('input[name=reset_email]').val(), csrfmiddlewaretoken: '{{ csrf_token }}'} ,
          type: 'POST',
          dataType : 'json',
      })
      .done(function(response) {
        alert(response.message)
      })
      .fail(function( xhr, status, errorThrown ) {
        alert('發生未知錯誤！請聯絡管理員')
        console.log( 'Error: ' + errorThrown + 'Status: ' + xhr.status)
              $('.login_pop').css('display','none')

      }) 
      })


      gsap.registerPlugin(ScrollTrigger);

      ScrollTrigger.create({
        trigger: ".section_2",
        start: "top-=45% top",
        // markers: true,
        onEnter: function () {
          $(".section_2").addClass("vivi");
        },
      });
      ScrollTrigger.create({
        trigger: ".section_3",
        start: "top-=80% top",
        // markers: true,
        onEnter: function () {
          $(".section_3").addClass("vivi");
        },
      });
      ScrollTrigger.create({
        trigger: ".section_4",
        start: "top-=80% top",
        // markers: true,
        onEnter: function () {
          $(".section_4").addClass("vivi");
        },
      });
    });
    // detect event on show / hide
    (function ($) {
      $.each(['show', 'hide'], function (i, ev) {
        var el = $.fn[ev];
        $.fn[ev] = function () {
          this.trigger(ev);
          return el.apply(this, arguments);
        };
      });
    })(jQuery);
  </script>
  <script>
    // loader
    var ajaxLoadTimeout;
    $(document).ajaxStart(function() {
        ajaxLoadTimeout = setTimeout(function() { 
            $(".loading_area").css("display","block");
        }, 1000);
    
    }).ajaxComplete(function() {
        clearTimeout(ajaxLoadTimeout);
        $(".loading_area").css("display","none");
    });

    window.addEventListener('error', function(event) {
      $(".loading_area").css("display","none");
      clearTimeout(ajaxLoadTimeout);
      alert('發生未知錯誤！請通知管理員')
    })

    $(function () {
      $(window).resize(function(){
				if($(window).width()>768){
 					$('.mb_bmenu').hide();
 					$('.hmenu').removeClass('active')
				}
				console.log(12);
			})	

      $(".hmenu").on("click", function () {
        $(".hmenu").toggleClass("active");
        $(".mb_bmenu").slideToggle();
      });
    });

    $('.ringbox').on('click',function (event) {
      if( $(this).hasClass('mb_open')){
        $(this).removeClass('mb_open');
      }else{
        $(this).addClass('mb_open');
      }
    });


    $('.rd_mb_two_menu_li').on('click',function (event) {
      event.preventDefault();
      if( $(this).closest('li').hasClass('now')){
          $(this).removeClass('now');
          $(this).find('.mbmu2').slideUp();
      }else{
          $(this).addClass('now');
          $(this).find('.mbmu2').slideDown();
      }
  });

    $(".mbmu2 a").on('click', function(){
      window.location = this.href;
    })

    $(".popbg .xx,.popbg .ovhy").click(function (e) {
      if ($(event.target).hasClass("xx") || $(event.target).hasClass("ovhy")) $(".popbg").hide();
    });

    // LOGIN 
    //https://emailregex.com
    function validateEmail(inputText){
      let mailformat = /(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/
      if(inputText.match(mailformat)){
          return true
      } else {
          return false
      }
    }

    // Function to check letters and numbers
    function checkPasswordStr(inputText){
      let letterNumber = /^[0-9a-zA-Z]{6,10}$/
      if(inputText.match(letterNumber)){
        return true
      } else {
          return false
      }
    }


    function login(){
      
      // remove all notice first
      $('#loginForm .noticbox').css('display','none')

      let checked = true
      
      if (!validateEmail($('#loginForm input[name=email]').val())){ // check email
        $('#loginForm input[name=email]').next('.noticbox').css('display','')
        checked = false
      }  

      if ($('#g-recaptcha-response').val()==''){ // check email
        $('.g-recaptcha').next('.noticbox').css('display','')
        checked = false
      }  
      
      if (!checkPasswordStr($('#loginForm input[name=password]').val())) { // check password
        $('#loginForm input[name=password]').next('.noticbox').css('display','')
        checked = false
      } 

      if (checked) {
        $.ajax({
            url: "{% url 'login' %}",
            data: $('#loginForm').serialize() ,
            type: 'POST',
            dataType : 'json',
        })
        .done(function(response) {
          console.log(response)
          alert(response.message)
          if (response.status=='success'){
            location.reload() }
        })
        .fail(function( xhr, status, errorThrown ) {
          alert('發生未知錯誤！請聯絡管理員')
          console.log( 'Error: ' + errorThrown + 'Status: ' + xhr.status)
          $('.login_pop').css('display','none')
        }) 
      } 
    }

    function register(){
      // remove all notice first
      $('#registerForm .noticbox').css('display','none')

      let checked = true

      if (!$('#registerForm input[name=name]').val()){ // check name
        $('#registerForm input[name=name]').next('.noticbox').css('display','')
        checked = false
      }  

      if (!validateEmail($('#registerForm input[name=email]').val())){ // check email
        $('#registerForm input[name=email]').next('.noticbox').css('display','')
        checked = false
      }  
      
      if (!checkPasswordStr($('#registerForm input[name=password]').val())) { // check password
        $('#registerForm input[name=password]').next('.noticbox').css('display','')
        checked = false
      } 
      
      if ($('#registerForm input[name=password]').val() != $('#registerForm input[name=repassword]').val()) { // check repassword
        $('#registerForm input[name=repassword]').next('.noticbox').css('display','')
        checked = false
      } 

      if (checked)
      {
          $.ajax({
              url: "{% url 'register' %}",
              data: $('#registerForm').serialize() ,
              type: 'POST',
              dataType : 'json',
          })
          .done(function(response) {
            
            if (response.status=='success'){
              window.location.href = "{% url 'register_verification' %}";
              
            } else {
              alert(response.message)
              $('.login_pop').css('display','none')
            }
              
          })
          .fail(function( xhr, status, errorThrown ) {
            alert('發生未知錯誤！請聯絡管理員')
            console.log( 'Error: ' + errorThrown + 'Status: ' + xhr.status)
            $('.login_pop').css('display','none')
          })  
        }
      }

      $('.login_pop').on('show', function(){
        $('.login_pop input').not('input[type="hidden"]').val('');
        $('.login_pop .noticbox').css('display','none')
      })
      

  </script>
  {% block script %}{% endblock script %}
</html>
