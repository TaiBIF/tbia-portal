{% extends 'base.html' %} {% load static %} 
{% block head %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
  integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
  crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
  integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
  crossorigin=""></script>
<script src="https://kit.fontawesome.com/b8e586964f.js" crossorigin="anonymous"></script>
{% endblock head %}
{% block title %}物種出現紀錄｜{% endblock %}
{% block style %}
<style>



  .arr-left {
    left: -30px;
    cursor: pointer;
    position: absolute;
    top: 50%;
    margin-top: -30px;
    left: 0;
    z-index: 5;
    width: 30px;
    height: 60px;
    background: url("/static/image/pic-arrl.svg") top left no-repeat;
    transition: all .3s;
    -moz-transition: all .3s;
    -o-transition: all .3s;
    -ms-transition: all .3s;
    -webkit-transition: all .3s
  }
  
  @media only screen and (min-width: 1000px) {
    .arr-left:hover {
      background: url("/static/image/pic-arrls.svg") top left no-repeat;
      transition: all .3s;
      -moz-transition: all .3s;
      -o-transition: all .3s;
      -ms-transition: all .3s;
      -webkit-transition: all .3s
    }
  }
  
  .arr-right {
    cursor: pointer;
    position: absolute;
    top: 50%;
    margin-top: -30px;
    right: 0;
    z-index: 5;
    width: 30px;
    height: 60px;
    background: url("/static/image/pic-arrr.svg") top left no-repeat;
    transition: all .3s;
    -moz-transition: all .3s;
    -o-transition: all .3s;
    -ms-transition: all .3s;
    -webkit-transition: all .3s
  }
  
  @media only screen and (min-width: 1000px) {
    .arr-right:hover {
      background: url("/static/image/pic-arrrs.svg") top left no-repeat;
      transition: all .3s;
      -moz-transition: all .3s;
      -o-transition: all .3s;
      -ms-transition: all .3s;
      -webkit-transition: all .3s
    }
  }

  .sc_de_main .inforall li p {
    word-wrap: break-word;
  }
</style>
{% endblock style %}
{% block body %}
<div class="path">
  <div class="main_1240">
    <a href="{% url 'index' %}" class="home"></a> <span>></span>
    <!--
    <a href="{% url 'search_occurrence' %}">條件搜尋</a>
    <span>></span>
    -->
    <p>物種出現紀錄</p>
  </div>
</div>

<div class="nbn_title">
  <h2>物種出現紀錄</h2>
</div>
<div class="container_area">
  <div class="main_1240">


    <div class="sc_de_top">
      <div class="left_area">
        <div class="cont_padbox">
          <div class="logo_area">
            {% if logo and row.references %}
            <img src="/static/image/partner/{{ logo }}" onclick="window.open('{{ row.references }}')" style="cursor:pointer">
            {% elif logo %}
            <img src="/static/image/partner/{{ logo }}" >
            {% endif %}
          </div>
          <h2>中⽂名：{{ row.common_name_c }}</h2>
          <h2>學名：{{ row.formatted_name|safe }}</h2>
          <div class="flex_inf">
            <div class="short">
              <p>來源資料庫使⽤中⽂名：{{ row.sourceVernacularName }}</p>
              <p>來源資料庫使⽤學名：{{ row.sourceScientificName|safe }}</p>
            </div>
            {% if row.taxonID %}
            <a class="code" target="_blank" href="http://web-staging.taicol.tw/taxon/{{ row.taxonID }}">物種編號：{{ row.taxonID }} <i class="fas fa-external-link-alt"></i></a>
            {% endif %}
              </div>
              {% if path_str %}

              <div class="rank_path">
                {{ path_str|safe }}
              </div>
              {% endif %}
  
      </div>
      </div>
      <div class="right_area">


        <div class="imgbox">        
          {% if row.associatedMedia|length > 1 %}
        <div class="arr-left" onclick="plusSlides(-1)">
        </div>
        <div class="arr-right" onclick="plusSlides(+1)">
        </div>
      {% endif %}
        {% for am in row.associatedMedia %}
          <div class="imgarea mySlides fade" style="background-image:url('{{ am }}') ;"></div>
        {% endfor %}
        </div>
      </div>

    </div>


    <div class="sc_de_main">
      <div class="left_area">
        <div class="whcont">
          <ul class="inforall">
            <li>
              <h3>敏感層級：</h3>
              <p>{{ row.sensitiveCategory }}</p>
            </li>
            <li>
              <h3>記錄者：</h3>
              <p>{{ row.recordedBy }}</p>
            </li>
            <li>
              <h3>鑑定層級：</h3>
              <p>{{ row.taxonRank }}</p>
            </li>
            <li>
              <h3>紀錄日期：</h3>
              {% if row.date != None and row.eventDate != row.date %}
              <p>{{ row.date }}<br><small style="color: silver">[原始紀錄日期] {{ row.eventDate }}</small></p>
              {% elif row.date != None and row.eventDate == row.date %}
              <p>{{ row.date }}</p>
              {% elif row.date == None and row.eventDate != None %}
              <p>---<br><small style="color: silver">[原始紀錄日期] {{ row.eventDate }}</small></p>
              {% else %}
              <p></p>
              {% endif %}
            </li>
            <li>
              <h3>數量：</h3>
              {% if row.quantity != None %}
              <p>{{ row.quantity }}</p>
              {% elif row.quantity == None and row.organismQuantity != None %}
              <p>---<br><small style="color: silver">[原始紀錄數量]{{ row.organismQuantity }}</small></p>
              {% else %}
              <p></p>
              {% endif %}
            </li>
            <li>
              <h3>數量單位：</h3>
              <p>{{ row.organismQuantityType }}</p>
            </li>
            <li>
              <h3>出現地：</h3>
              <p>{{ row.locality }}</p>
            </li>            
            <li>
              <h3>授權狀況：</h3>
              <p>{{ row.license }}</p>
            </li>
            <li>
              <h3>資料集名稱：</h3>
              <p>{{ row.datasetName }}</p>
            </li>
            <li>
              <h3>資料集聯絡⼈：</h3>
              <p>{{ row.resourceContacts }}</p>
            </li>          
          </ul>
          {% if row.references != '' %}
          <a style="cursor: pointer" href="{{ row.references }}" target="_blank" class="from_data">來源資料庫：{{ row.rightsHolder }} <i class="fas fa-external-link-alt"></i></a>
          {% else %}
          <a class="from_data">來源資料庫：{{ row.rightsHolder }}</a>
          {% endif %}

        </div>
      </div>
      <div class="right_area">
        <div class="map_img">
          <div class="imgbox" style="height: 390px; width: auto;">
            <!--435*390 or 870*780 用background-image替換連結-->
            <!--<div class="img"></div>-->
            <div id="map" class="img"></div>
          </div>
        </div>
        <ul class="inforall">
          <li>
            <h3>經度：</h3>
            {% if row.lon != None %}
            <p>{{ row.lon }}</p>
            {% elif row.lon == None and row.verbatimLongitude != None %}
            <p>---<br><small style="color: silver">[原始紀錄經度]{{ row.verbatimLongitude }}</small></p>
            {% else %}
            <p></p>
            {% endif %}
          </li>
          <li>
            <h3>座標誤差：</h3>
            <p>{{ row.coordinateUncertaintyInMeters }}</p>
          </li>
          <li>
            <h3>緯度：</h3>
            {% if row.lat != None %}
            <p>{{ row.lat }}</p>
            {% elif row.lat == None and row.verbatimLatitude != None %}
            <p>---<br><small style="color: silver">[原始紀錄緯度]{{ row.verbatimLatitude }}</small></p>
            {% else %}
            <p></p>
            {% endif %}
          </li>
          <li>
            <h3>座標是否有模糊化：</h3>
            <p>{{ row.dataGeneralizations }}</p>
          </li>
          <li>
            <h3>座標系統：</h3>
            <p>{{ row.verbatimCoordinateSystem }}</p>
          </li>
          <li>
            <h3>座標模糊化程度：</h3>
            <p>{{ row.coordinatePrecision }}</p>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

{% endblock body %}

{% block script %}
<script>

  let slideIndex = 1;
	showSlides(slideIndex);

	function plusSlides(n) {
		showSlides(slideIndex += n);
	}

	function currentSlide(n) {
		showSlides(slideIndex = n);
	}

	function showSlides(n) {
		let i;
		let slides = document.getElementsByClassName("mySlides");
		if (n > slides.length) {slideIndex = 1}    
		if (n < 1) {slideIndex = slides.length}
		for (i = 0; i < slides.length; i++) {
			slides[i].style.display = "none";  
		}
		slides[slideIndex-1].style.display = "block";  
		// 修改popup裡面的照片
    /*
		$('.imagepop #spe-image').attr("src",$('.mySlides:visible img').attr('src'));
		$('.imagepop #image_author').html($('.mySlides:visible img').next('.image_author').html());
		$('.imagepop #image_provider').html($('.mySlides:visible img').next('.image_provider').html());*/
	}


  let redIcon = new L.Icon({
    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41]
  });
  
  {% if row.lat != None and row.lon != None %}
  let map = L.map('map').setView(['{{ row.lat }}', '{{ row.lon }}'],6);
  L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);
  L.marker(['{{ row.lat }}', '{{ row.lon }}'], {icon: redIcon}).addTo(map);
  {% else %}
  let map = L.map('map').setView([23.5, 121.2], 7);
    L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);
  {% endif %}

</script>
{% endblock script %}
